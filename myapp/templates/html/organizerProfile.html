{% load static %}
<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@{{ organizer.username }} ‚Äì Smart Events</title>
    <link rel="stylesheet" href="{% static 'CSS/organizerProfile.css' %}">
</head>
<body>

<header class="top-header">
    <div class="top-inner">
        <a class="brand" href="{% url 'homepage' %}">
            <img src="{% static 'Images/logo.png' %}" alt="Smart Events" class="brand-logo" />
            <div class="brand-text">
                <div class="brand-name">Smart Events</div>
                <div class="brand-tagline">Organizer Profile</div>
            </div>
        </a>
        <nav class="top-actions">
            <a class="home-link" href="{% url 'userHome' %}">‚Üê Back to Explore</a>
            <form method="post" action="{% url 'logout' %}" style="display: inline;">
                {% csrf_token %}
                <button type="submit" class="logout-btn">Logout</button>
            </form>
        </nav>
    </div>
</header>

<main class="page-container">
    <section class="profile-intro-card">
        <div class="avatar-circle">@</div>
        <h1>{{ organizer.username }}</h1>
        <p class="subtitle">Trusted Organizer on Smart Events</p>
    </section>
<section class="reviews-card">
  <div class="reviews-head">
    <h2 class="section-title">Reviews</h2>
    <div class="rating-summary">
      <div class="stars">
        {% for i in "12345" %}
          {% if avg_rating|floatformat:0 >= forloop.counter %}
            <span class="star filled">‚òÖ</span>
          {% else %}
            <span class="star">‚òÖ</span>
          {% endif %}
        {% endfor %}
      </div>
      <div class="rating-text">
        {{ avg_rating|floatformat:1 }} / 5 ‚Ä¢ {{ reviews_count }} review{{ reviews_count|pluralize }}
      </div>
    </div>
  </div>

  {% if request.user.id != organizer.id %}
  <form method="post" class="review-form">
    {% csrf_token %}
    <input type="hidden" name="review_submit" value="1" />

    <div class="review-form-row">
      <label class="review-label">Your rating</label>
      <select name="rating" class="review-select" required>
        <option value="">Choose‚Ä¶</option>
        <option value="1" {% if my_review and my_review.rating == 1 %}selected{% endif %}>1</option>
        <option value="2" {% if my_review and my_review.rating == 2 %}selected{% endif %}>2</option>
        <option value="3" {% if my_review and my_review.rating == 3 %}selected{% endif %}>3</option>
        <option value="4" {% if my_review and my_review.rating == 4 %}selected{% endif %}>4</option>
        <option value="5" {% if my_review and my_review.rating == 5 %}selected{% endif %}>5</option>
      </select>
    </div>

    <div class="review-form-row">
      <label class="review-label">Comment (optional)</label>
      <textarea name="comment" class="review-textarea" rows="3"
        placeholder="Write a short review‚Ä¶">{% if my_review %}{{ my_review.comment }}{% endif %}</textarea>
    </div>

    <button type="submit" class="review-btn">
      {% if my_review %}Update review{% else %}Submit review{% endif %}
    </button>
  </form>
  {% else %}
    <p class="review-hint">You can't review your own organizer account.</p>
  {% endif %}

  <div class="reviews-list">
    {% for r in reviews %}
      <article class="review-item">
        <div class="review-top">
          <div class="review-user">@{{ r.user.username }}</div>
          <div class="review-stars">
            {% for i in "12345" %}
              {% if r.rating >= forloop.counter %}
                <span class="star filled">‚òÖ</span>
              {% else %}
                <span class="star">‚òÖ</span>
              {% endif %}
            {% endfor %}
          </div>
        </div>
        {% if r.comment %}
          <p class="review-comment">{{ r.comment }}</p>
        {% endif %}
        <div class="review-date">{{ r.created_at|date:"d.m.Y H:i" }}</div>
      </article>
    {% empty %}
      <div class="empty-state"><p>No reviews yet.</p></div>
    {% endfor %}
  </div>
</section>

    <section class="feed">
        <h2 class="section-title">Events by this organizer</h2>
        {% for e in events %}
          <article class="post-card" data-event-id="{{ e.id }}">
            <div class="post-header">
                <h3 class="post-title">{{ e.title }}</h3>
                {% if e.category %}
                  <span class="category-tag">{{ e.category }}</span>
                {% endif %}
            </div>

            <div class="post-meta">
              <span>üìÖ {{ e.date }}</span>
              <span>‚è∞ {{ e.time }}</span>
              <span>üìç {{ e.location }}</span>
            </div>

            <p class="post-desc">{{ e.description }}</p>

            <div class="post-footer">
              <div class="capacity-info">
                <span class="icon">üë•</span>
                <span id="count-{{ e.id }}">{{ e.app_count }}</span>
                {% if e.capacity %}
                  / <span id="cap-{{ e.id }}">{{ e.capacity }}</span>
                {% endif %}
              </div>

              <button
                class="apply-action {% if e.applied %}cancel{% endif %}"
                data-event-id="{{ e.id }}"
                data-applied="{% if e.applied %}1{% else %}0{% endif %}"
                data-full="{% if e.full %}1{% else %}0{% endif %}"
                data-capacity="{{ e.capacity|default:0 }}"
              >
                {% if e.applied %}Cancel application{% else %}Apply now{% endif %}
              </button>
            </div>

            {% if e.full and not e.applied %}
              <div class="full-msg" id="fullmsg-{{ e.id }}">‚ö†Ô∏è This event is full.</div>
            {% else %}
              <div class="full-msg hidden" id="fullmsg-{{ e.id }}">‚ö†Ô∏è This event is full.</div>
            {% endif %}
          </article>
        {% empty %}
          <div class="empty-state">
            <p>This organizer has no events yet.</p>
          </div>
        {% endfor %}
    </section>
</main>

<footer class="site-footer">
    <div class="footer-emails">
        <a href="mailto:beatriz.komaromi05@e-uvt.ro">beatriz.komaromi05@e-uvt.ro</a>
        <span class="dot">‚Ä¢</span>
        <a href="mailto:naomi.rascol04@e-uvt.ro">naomi.rascol04@e-uvt.ro</a>
    </div>
    <div class="footer-copy">
        ¬© 2026 Place Informatics Ltd ‚Äî Timi»ôoara, Romania
    </div>
</footer>

<script src="{% static 'JS/organizerProfile.js' %}"></script>
</body>
</html>